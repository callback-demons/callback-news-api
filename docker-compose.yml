version: '3.7'
    
services:
    minio:
        image: minio/minio
        volumes:
            - minio-data:/export
        ports:
            - 9000:80
        environment:
            MINIO_ACCESS_KEY: access_key
            MINIO_SECRET_KEY: secret_key
        command: server /export --address=:80
    db:
        image: postgres:11-alpine
        volumes:
            - db-data:/var/lib/postgresql/data/
        environment:
            POSTGRES_DB: callback_news
            POSTGRES_USER: admin
            POSTGRES_PASSWORD: 890306
    api:
        build:
            context: ./app
        command: gunicorn api_news.wsgi:application --bind 0.0.0.0:8000
        volumes:
            - ./app/:/usr/src/app/
        expose: 
            - 8000
        env_file:
            - ./app/.env.dev
        depends_on:
            - db
            - minio
    nginx:
        image: nginx:1.17.4-alpine
        ports:
            - 8000:80
        depends_on:
            - api
        volumes:
            - ./app/static:/home/api/web/static
            - ./docker/nginx.conf:/etc/nginx/conf.d/default.conf
volumes:
    db-data:
    minio-data:

